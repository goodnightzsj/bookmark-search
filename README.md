# 书签搜索 (Bookmark Search)

一个现代化的浏览器书签搜索扩展，支持快捷键快速搜索和打开书签。

## ✨ 功能特性

- 🔍 **快速搜索**：实时搜索书签标题和URL
- ⌨️ **键盘导航**：完整的键盘操作支持
- 🎨 **现代UI**：精美的渐变设计和流畅动画
- 📱 **响应式设计**：自适应各种屏幕尺寸
- ⚡ **性能优化**：防抖搜索，智能缓存
- 📊 **实时同步**：自动监听书签变化，无需手动刷新
- ⏰ **定时轮询**：支持自定义同步间隔（5分钟～24小时），确保数据最新
- 📍 **位置追踪**：记录每个书签的完整文件夹路径
- 📝 **详细历史**：跟踪书签的新增、删除、编辑和移动操作，清晰展示源位置和目的位置
- 🔔 **同步提示**：显示最后同步时间和下次同步时间
- 🔄 **智能对比同步**：每次同步时对比新旧数据，完整记录所有变更（含远程同步的变化）
- 📂 **文件夹级联删除**：删除文件夹时自动记录所有子书签的删除历史
- 📤 **书签导出**：支持多选导出历史记录中的书签，自动去重，兼容主流浏览器格式

## 🚀 使用方法

### 安装
1. 打开 Chrome/Edge 浏览器
2. 进入扩展管理页面
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目文件夹

### 使用
- **快捷键唤起**：推荐使用 Ctrl+Shift+Q (Windows/Linux) 或 Command+Shift+Q (Mac)，可在浏览器扩展快捷键设置中自定义
- **点击图标**：点击扩展图标查看状态和管理
- **搜索**：输入关键词搜索书签
- **导航**：使用方向键或鼠标选择
- **打开书签**：Enter 键在新标签页打开，Ctrl+Enter 在当前页打开
- **关闭**：按 Esc 键或点击遮罩层

## ⚠️ 使用限制

### 特殊页面限制
由于浏览器安全策略，扩展无法在系统页面中使用，包括 chrome:// 和 edge:// 开头的页面。这是浏览器的安全设计，防止恶意扩展在系统页面注入代码。

**解决方法**：请切换到普通网页使用扩展功能。

## ⌨️ 快捷键说明

### 理想快捷键与限制
我们希望使用 Ctrl+Space 作为快捷键，但由于浏览器限制（不允许使用功能键如 Space、Enter、Tab）和系统占用（输入法切换），实际无法使用。

### 推荐替代方案
需要在浏览器扩展快捷键设置页面手动配置：

**Windows/Linux 推荐键位**：
- **首选**：`Ctrl+Shift+Q` (Q = Quick，避免输入法冲突)
- **备选1**：`Ctrl+Alt+B` (B = Bookmark，Alt 组合相对安全)
- **备选2**：`Ctrl+Shift+;` (分号键，很少冲突)

**Mac 推荐键位**：
- **首选**：`Command+Shift+Q`
- **备选**：`Command+Shift+B`

**注意**：避免使用 `Ctrl+Shift+F`，该组合在 Windows 下与微软输入法的简繁体切换冲突

## 🔄 书签更新机制

### 自动同步原理
扩展采用多层次的书签同步机制，确保数据实时更新：

### 更新时机
1. **扩展首次加载**：检查本地缓存，如无缓存则从浏览器获取完整书签树并缓存，记录同步时间
2. **实时监听**：自动监听书签的新增、删除、编辑和移动操作，立即同步更新
3. **定时轮询**：根据用户设置的间隔（默认30分钟）自动同步书签，可选5分钟至24小时，或禁用
4. **手动刷新**：用户可在Popup或设置页面手动同步，完整重新获取所有书签
5. **设置页面实时更新**：检测到数据变化时自动刷新界面，无需手动刷新

### 同步间隔设置
用户可以在设置页面自定义同步间隔：
- **5分钟** - 数据最新，适合频繁操作书签的用户
- **10/15/30分钟** - 平衡性能与实时性（推荐30分钟）
- **1/2/6/12/24小时** - 适合不常修改书签的用户
- **禁用** - 仅依靠实时监听和手动同步

Popup页面会显示最后同步时间和下次同步时间，让用户随时了解同步状态。

### 数据流向
用户操作 → 浏览器书签API → 后台监听器 → 内存数组 → 本地存储 → 界面自动更新

### 支持的操作
- **新增书签**：实时添加到搜索列表，记录新增位置
- **删除书签**：实时从列表移除，记录删除前位置
- **编辑书签**：获取完整书签信息，更新标题和URL，记录当前位置
- **移动书签**：跟踪文件夹变化，同时记录源位置和目的位置

### 历史记录功能
系统自动记录所有书签操作，包括操作类型、书签信息、位置信息和时间戳，最多保留100条记录。

**位置显示规则**：
- 🟢 **新增**：显示"新增到：文件夹路径"
- 🔴 **删除**：显示"删除自：文件夹路径"
- 🔵 **修改**：显示"位置：文件夹路径"
- 🔴🟢 **移动**：分两行显示"从：源路径" 和 "到：目标路径"

### 性能优化
- 使用本地缓存减少API调用
- 增量更新而非全量刷新
- 设置页面实时更新，无需轮询
- 防抖搜索，智能缓存机制

### 故障排查
如遇书签数量不准确或历史记录不显示，可在设置页面点击"同步书签"按钮手动刷新。设置页面支持实时更新，会自动显示"已自动更新"的视觉反馈。

## 🎯 首次使用

第一次在新标签页使用快捷键时，扩展会自动注入必要的脚本，之后使用将即时响应。

## 🛠️ 技术栈

- Manifest V3
- Vanilla JavaScript
- CSS3 (Animations, Gradients, Clamp)
- Chrome Extension APIs

## 📂 相关文件

- `background.js` - 后台服务，处理书签获取和监听
- `content.js` - 内容脚本，提供搜索界面
- `popup.html/js` - 扩展弹窗，显示状态和快捷操作
- `settings.html/js` - 设置页面，管理配置和查看历史
- `content.css` - 样式文件，现代化UI设计

## 📝 更新日志

### v1.4 - 智能对比同步与书签导出
- ✅ 智能对比同步：每次同步时对比新旧书签数据，检测并记录所有差异
- ✅ 完整路径追踪：修复路径记录问题，现在显示包含当前文件夹的完整路径
- ✅ 文件夹级联删除：删除文件夹时自动识别并记录所有子书签的删除历史
- ✅ 书签导出功能：
  - 支持进入选择模式多选历史记录
  - 默认全选，支持全选/取消全选
  - 同一URL自动去重，保留最新记录
  - 导出为Netscape Bookmark格式，兼容Chrome/Edge/Firefox
- ✅ 远程同步支持：扩展未运行时的远程书签变更，下次同步时能完整记录

### v1.3 - 定时同步与位置追踪
- ✅ 定时轮询功能：支持5分钟～24小时自定义同步间隔
- ✅ 书签位置追踪：记录每个书签的完整文件夹路径
- ✅ 详细历史记录显示：
  - 新增操作显示目的位置
  - 删除操作显示源位置
  - 修改操作显示当前位置
  - 移动操作同时显示源位置和目的位置
- ✅ 同步时间显示：Popup页面显示最后同步和下次同步时间
- ✅ 同步间隔可配置：在设置页面实时调整并生效
- ✅ 添加alarms权限支持定时任务

### v1.2 - 移动操作支持
- ✅ 支持书签移动操作监听
- ✅ 历史记录显示目标文件夹
- ✅ 新增移动操作标签样式

### v1.1 - 实时更新优化
- ✅ 设置页面自动更新功能
- ✅ 视觉反馈通知机制
- ✅ 修复编辑书签历史记录问题
- ✅ 使用完整书签信息

### v1.0 - 初始版本
- ✅ 基础书签搜索功能
- ✅ 完整键盘导航支持
- ✅ 现代化UI设计
- ✅ 响应式布局
- ✅ 动态脚本注入
- ✅ 特殊页面提示
- ✅ 实时书签监听
- ✅ 书签历史记录
